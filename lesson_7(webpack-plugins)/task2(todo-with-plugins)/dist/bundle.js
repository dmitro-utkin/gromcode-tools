(()=>{"use strict";const t=(t,e)=>{localStorage.setItem(t,JSON.stringify(e))},e=t=>JSON.parse(localStorage.getItem(t)),n="https://662630a1052332d55321f809.mockapi.io/api/v1/tasks",s=()=>fetch(n).then((t=>t.json())).then((t=>(t=>t.map((({id:t,...e})=>({...e,id:t}))))(t))),a=document.querySelector(".list"),i=(t,e)=>t.done-e.done!=0?t.done-e.done:t.done?new Date(e.finishDate)-new Date(t.finishDate):new Date(e.createDate)-new Date(t.createDate),c=({text:t,done:e,id:n})=>{const s=document.createElement("li");s.classList.add("list__item");const a=(({done:t,id:e})=>{const n=document.createElement("input");return n.setAttribute("type","checkbox"),n.setAttribute("data-id",e),n.checked=t,n.classList.add("list__item-checkbox"),n})({done:e,id:n});e&&s.classList.add("list__item_done");const i=document.createElement("span");i.classList.add("list__item-text"),i.textContent=t;const c=document.createElement("button");return c.classList.add("list__item-delete-btn"),c.onclick=()=>o(n),s.append(a,i,c),s},o=e=>{(t=>fetch(`${n}/${t}`,{method:"DELETE"}))(e).then((()=>s())).then((e=>{t("tasksList",e),d()}))},d=()=>{const t=e("tasksList")||[];a.innerHTML="";const n=t.sort(i).map(c);a.append(...n)},r=()=>{const e=document.querySelector(".task-input"),a=e.value;if(!a)return;e.value="";var i;(i={text:a,done:!1,createDate:(new Date).toISOString()},fetch(n,{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(i)})).then((()=>s())).then((e=>{t("tasksList",e),d()}))},l=a=>{if(!a.target.classList.contains("list__item-checkbox"))return;const i=a.target.dataset.id,c=e("tasksList"),{text:o,createDate:r}=c.find((t=>t.id===i)),l=a.target.checked,h={text:o,createDate:r,done:l,finishDate:l?(new Date).toISOString():null};((t,e)=>fetch(`${n}/${t}`,{method:"PUT",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(e)}))(i,h).then((()=>s())).then((e=>{t("tasksList",e),d()}))};document.addEventListener("DOMContentLoaded",(()=>{s().then((e=>{t("tasksList",e),d()})),document.querySelector(".create-task-btn").addEventListener("click",r),document.querySelector(".list").addEventListener("click",l)})),window.addEventListener("storage",(t=>{"tasksList"===t.key&&d()}))})();